(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66615858"],{2e3:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-terminal"},[t.showHeader?n("div",{staticClass:"terminal-header"},[n("h4",[t._v(t._s(t.title))]),t._m(0),n("div",{staticClass:"terminal-header-right"},[0!==t.status?n("span",{class:t.formatStatus(t.status).color},[t._v(t._s(t.formatStatus(t.status).name))]):t._e(),n("span",{staticStyle:{"margin-left":"10px"}},[t._v("Automatic scrolling "),n("el-switch",{model:{value:t.autoScroll,callback:function(e){t.autoScroll=e},expression:"autoScroll"}})],1)])]):t._e(),n("div",[n("div",{ref:"terminalWindow",staticClass:"terminal-window"},[t._l(t.messageList,(function(e,a){return n("p",{key:a},[e.time?n("span",[t._v(t._s(t.dateFormat(e.time)))]):t._e(),e.level?n("span",{staticClass:"level",class:t.formatLevel(e.level).color},[t._v(t._s(t.formatLevel(e.level).name))]):t._e(),n("code",[t._v(t._s(e.text))])])})),n("p",{ref:"terminalLastLine",staticClass:"terminal-last-line"})],2)])])},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"shell-dots"},[n("li",{staticClass:"shell-dots-red"}),n("li",{staticClass:"shell-dots-yellow"}),n("li",{staticClass:"shell-dots-green"})])}],s=(n("7db0"),n("fb6a"),n("a9e3"),n("d3b7"),n("159b"),n("ed08")),o=n("9cbb"),i={name:"Terminal",props:{title:{required:!1,type:String,default:"Terminal"},status:{required:!1,type:Number,default:0},showHeader:{required:!1,type:Boolean,default:!1},autoScroll:{required:!1,type:Boolean,default:!0},init:{required:!1,type:Boolean,default:!0},data:{required:!0,type:Array,default:function(){return[]}}},data:function(){return{messageList:[],levelList:o["b"],statusList:[{code:1,name:"Retrieving",color:"info"},{code:2,name:"Normal",color:"success"},{code:3,name:"Abnormal",color:"error"}]}},watch:{data:function(t){var e=this;null===t&&(t=[]);var n=[];!this.init&&t.length>this.messageList.length?n=t.slice(this.messageList.length,t.length):(this.messageList=[],n=t),n.forEach((function(t){var n=e.messageList[e.messageList.length-1];t.clear&&void 0!==n&&n.clear&&e.messageList.pop(),e.pushToList(t)}))}},methods:{dateFormat:function(t){return Object(s["a"])(t,"yyyy-MM-dd hh:mm:ss")},formatStatus:function(t){var e=this.statusList.find((function(e){return e.code===t}));return e||(e={code:1,name:"Info",color:"info"}),e},formatLevel:function(t){var e=this.levelList.find((function(e){return e.code===t}));return e||(e={code:1,name:"Info",color:"info"}),e},pushToList:function(t){this.messageList.push(t),this.autoScroll&&this.autoScrollHandler()},autoScrollHandler:function(){var t=this;this.$nextTick((function(){t.$refs.terminalWindow.scrollTop=t.$refs.terminalLastLine.offsetTop}))}}},c=i,l=(n("38f0"),n("2877")),u=Object(l["a"])(c,a,r,!1,null,"284c54bb",null);e["a"]=u.exports},2900:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return r}));var a="/api/v1/ws/task/sockjs",r="/api/v1/ws/log/sockjs"},"38f0":function(t,e,n){"use strict";n("532c")},"3ffe":function(t,e,n){"use strict";n.d(e,"g",(function(){return r})),n.d(e,"e",(function(){return s})),n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return i})),n.d(e,"q",(function(){return c})),n.d(e,"o",(function(){return l})),n.d(e,"h",(function(){return u})),n.d(e,"n",(function(){return d})),n.d(e,"j",(function(){return m})),n.d(e,"k",(function(){return f})),n.d(e,"a",(function(){return b})),n.d(e,"m",(function(){return p})),n.d(e,"l",(function(){return h})),n.d(e,"i",(function(){return g})),n.d(e,"d",(function(){return O})),n.d(e,"p",(function(){return j})),n.d(e,"f",(function(){return v}));n("99af");var a=n("b775");function r(t){return Object(a["a"])({url:"/repository",method:"get",params:t})}function s(t){return Object(a["a"])({url:"/repository/".concat(t),method:"get"})}function o(t){return Object(a["a"])({url:"/repository/".concat(t),method:"delete"})}function i(t){return Object(a["a"])({url:"/repository",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/repository/".concat(t.id),method:"put",data:t})}function l(t){return Object(a["a"])({url:"/restic/".concat(t.id,"/snapshots"),method:"get",params:t})}function u(t,e,n){return Object(a["a"])({url:"/restic/".concat(t,"/ls/").concat(e),method:"get",params:n})}function d(t,e,n){return Object(a["a"])({url:"/restic/".concat(t,"/search/").concat(e),method:"get",params:n})}function m(t){return Object(a["a"])({url:"/restic/".concat(t,"/parms"),method:"get"})}function f(t){return Object(a["a"])({url:"/restic/".concat(t,"/parmsForMy"),method:"get"})}function b(t){return Object(a["a"])({url:"/restic/".concat(t,"/check"),method:"post"})}function p(t){return Object(a["a"])({url:"/restic/".concat(t,"/rebuild-index"),method:"post"})}function h(t){return Object(a["a"])({url:"/restic/".concat(t,"/prune"),method:"post"})}function g(t){return Object(a["a"])({url:"/restic/".concat(t,"/migrate"),method:"post"})}function O(t,e){return Object(a["a"])({url:"/restic/".concat(t,"/forget"),method:"post",params:{snapshotid:e}})}function j(t,e){return Object(a["a"])({url:"/restic/".concat(t,"/unlock"),method:"post",params:{all:e}})}function v(t,e){return Object(a["a"])({url:"/operation/last/".concat(e,"/").concat(t),method:"get"})}},"532c":function(t,e,n){},"6b11":function(t,e,n){},"9cbb":function(t,e,n){"use strict";n.d(e,"e",(function(){return a})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i}));var a=[{code:1,name:"S3",tips:"Minio"},{code:3,name:"Sftp",tips:"Not recommended"},{code:4,name:"Local",tips:"Recommended for testing"},{code:5,name:"Rest",tips:"Recommended"}],r=[{code:"last",name:"Count",tips:"Count"},{code:"hourly",name:"Hourly",tips:"Hourly"},{code:"daily",name:"Daily",tips:"Daily"},{code:"weekly",name:"Weekly",tips:"Weekly"},{code:"monthly",name:"Monthly",tips:"Monthly"},{code:"yearly",name:"Yearly",tips:"Yearly"}],s=[{code:1,name:"Fetching",color:"info"},{code:2,name:"Normal",color:"success"},{code:3,name:"Error",color:"danger"}],o=[{code:1,name:"Info",color:"info"},{code:2,name:"Warning",color:"warning"},{code:3,name:"Success",color:"success"},{code:4,name:"Error",color:"error"}],i=[{code:0,name:"Auto",color:"success"},{code:1,name:"Off",color:"info"},{code:2,name:"Maximum",color:"warning"}]},e039:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",[n("el-row",{staticClass:"panel-group",attrs:{gutter:40}},[n("el-col",{staticClass:"card-panel-col",attrs:{xs:6,sm:6,lg:6}},[n("el-form",{attrs:{"label-position":"right","label-width":"80px"}},[n("el-form-item",{attrs:{label:"Name:"}},[n("span",[t._v(t._s(t.repoData.name))])]),n("el-form-item",{attrs:{label:"Server:"}},[n("span",[t._v(t._s(t.repoData.endPoint))])]),t.repoData.bucket?n("el-form-item",{attrs:{label:"Bucket:"}},[n("span",[t._v(t._s(t.repoData.bucket))])]):t._e(),n("el-form-item",{attrs:{label:"Created At:"}},[n("span",[t._v(t._s(t.dateFormat(t.repoData.createdAt)))])]),n("el-form-item",{attrs:{label:"Type:"}},[n("span",[t._v(t._s(t.formatType(t.repoData.type)))])]),n("el-form-item",{attrs:{label:"Format Version:"}},[n("span",[t._v(t._s(t.repoData.repositoryVersion))]),n("el-button",{attrs:{type:"text"},on:{click:function(e){return t.migrationHandler()}}},[t._v("Upgrade Version")])],1),n("el-form-item",{attrs:{label:"Connection Status:"}},[n("el-tag",{attrs:{type:t.formatStatus(t.repoData.status).color}},[t._v(" "+t._s(t.formatStatus(t.repoData.status).name)+" ")])],1),""!==t.repoData.errmsg?n("el-form-item",{attrs:{label:"Error Message:"}},[n("span",[t._v(t._s(t.repoData.errmsg))])]):t._e(),n("el-form-item",{attrs:{label:"Data Status:"}},[n("div",{staticClass:"form-btn"},[n("el-tag",{attrs:{type:t.formatStatus(t.checkObj.status).color}},[t._v(" "+t._s(t.formatStatus(t.checkObj.status).name)+" ")]),n("el-button",{attrs:{type:"text"},on:{click:function(e){return t.checkHandler()}}},[t._v("Re-check")])],1)]),n("el-form-item",{attrs:{label:"Rebuild Index:"}},[n("div",{staticClass:"form-btn"},[n("el-tag",{attrs:{type:t.formatStatus(t.rebuildIndexObj.status).color}},[t._v(" "+t._s(t.formatStatus(t.rebuildIndexObj.status).name)+" ")]),n("el-button",{attrs:{type:"text"},on:{click:function(e){return t.rebuildIndexHandler()}}},[t._v("Re-execute")])],1)]),n("el-form-item",{attrs:{label:"Clean Unused Data:"}},[n("div",{staticClass:"form-btn"},[n("el-tag",{attrs:{type:t.formatStatus(t.pruneObj.status).color}},[t._v(" "+t._s(t.formatStatus(t.pruneObj.status).name)+" ")]),n("el-button",{attrs:{type:"text"},on:{click:function(e){return t.pruneHandler()}}},[t._v("Re-execute")])],1)]),n("el-form-item",{attrs:{label:"Clear Lock:"}},[n("div",{staticClass:"form-btn"},[n("el-button",{attrs:{type:"text"},on:{click:function(e){return t.unlockHandler()}}},[t._v("Execute")])],1)])],1)],1),n("el-col",{staticClass:"card-panel-col",attrs:{xs:18,sm:18,lg:18}},[n("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":t.handleTabClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"Data Status",name:"1"}},[n("Terminal",{attrs:{title:"Logs",showHeader:"",init:t.checkObj.init,data:t.checkObj.logs}})],1),n("el-tab-pane",{attrs:{label:"Rebuild Index",name:"2"}},[n("Terminal",{attrs:{title:"Logs",showHeader:"",init:t.rebuildIndexObj.init,data:t.rebuildIndexObj.logs}})],1),n("el-tab-pane",{attrs:{label:"Clean Data",name:"3"}},[n("Terminal",{attrs:{title:"Logs",showHeader:"",init:t.pruneObj.init,data:t.pruneObj.logs}})],1),n("el-tab-pane",{attrs:{label:"Version Upgrade",name:"5"}},[n("Terminal",{attrs:{title:"Logs",showHeader:"",init:t.migrateObj.init,data:t.migrateObj.logs}})],1)],1)],1)],1)],1)])},r=[],s=(n("7db0"),n("fb6a"),n("b0c0"),n("e9c4"),n("a9e3"),n("b64b"),n("d3b7"),n("3ffe")),o=n("2000"),i=n("ed08"),c=n("cc7d"),l=n.n(c),u=n("5f87"),d=n("2900"),m=n("9cbb"),f={name:"Operation",components:{Terminal:o["a"]},data:function(){return{checkObj:{status:1,init:!0,logs:[]},rebuildIndexObj:{status:1,init:!0,logs:[]},pruneObj:{status:1,init:!0,logs:[]},migrateObj:{status:1,init:!0,logs:[]},repoData:{type:4},listQuery:{id:0},sock:null,curSockObj:1,activeName:"1",statusList:m["d"],typeList:m["e"]}},created:function(){this.listQuery.id=this.$route.params&&this.$route.params.id,this.getRepo(),this.getLastOper(5),this.getLastOper(3),this.getLastOper(2),this.getLastOper(1)},beforeDestroy:function(){this.sock=null},methods:{checkHandler:function(){var t=this;this.checkObj.logs=[],this.checkObj.init=!0,Object(s["a"])(this.listQuery.id).then((function(e){t.curSockObj=1,t.openSockjs(e.data)})).finally((function(){t.activeName="1"}))},migrationHandler:function(){var t=this;this.migrateObj.logs=[],this.migrateObj.init=!0,Object(s["i"])(this.listQuery.id).then((function(e){t.curSockObj=5,t.openSockjs(e.data)})).finally((function(){t.activeName="5"}))},rebuildIndexHandler:function(){var t=this;this.rebuildIndexObj.logs=[],this.rebuildIndexObj.init=!0,Object(s["m"])(this.listQuery.id).then((function(e){t.curSockObj=2,t.openSockjs(e.data)})).finally((function(){t.activeName="2"}))},pruneHandler:function(){var t=this;this.pruneObj.logs=[],this.pruneObj.init=!0,Object(s["l"])(this.listQuery.id).then((function(e){t.curSockObj=3,t.openSockjs(e.data)})).finally((function(){t.activeName="3"}))},unlockHandler:function(){var t=this;Object(s["p"])(this.listQuery.id).then((function(e){t.$notify.success("Successfully cleared"+e.data+"locks.")}))},getLastOper:function(t){var e=this;Object(s["f"])(this.listQuery.id,t).then((function(n){var a=n.data;a.logs||(a.logs=[]),1!==a.status?(a.logs.length>100&&(a.logs=a.logs.slice(a.logs.length-100)),e.updateLog(t,a,!1)):(e.curSockObj=t,e.openSockjs(a.id))}))},updateLog:function(t,e,n){switch(t){case 1:n?this.checkObj.logs.push(e):this.checkObj=e,this.checkObj.init=!n;break;case 2:n?this.rebuildIndexObj.logs.push(e):this.rebuildIndexObj=e,this.rebuildIndexObj.init=!n;break;case 3:n?this.pruneObj.logs.push(e):this.pruneObj=e,this.pruneObj.init=!n;break;case 5:n?this.migrateObj.logs.push(e):this.migrateObj=e,this.migrateObj.init=!n;break;default:}},openSockjs:function(t){var e=Object(u["a"])().token,n=this;null===this.sock?(this.sock=new l.a(d["a"]+"?token="+e),this.sock.onopen=function(){n.sock.send(JSON.stringify({Id:t})),n.sock.onmessage=function(t){var e=JSON.parse(t.data);e.message?(n.$notify({type:"error",title:"Error",message:e.message}),n.getLastOper(n.curSockObj)):n.updateLog(n.curSockObj,e,!0)}},this.sock.onclose=function(){n.sock=null,n.getLastOper(n.curSockObj)}):this.sock.send(JSON.stringify({Id:t}))},getRepo:function(){var t=this;Object(s["e"])(this.listQuery.id).then((function(e){t.repoData=e.data}))},handleTabClick:function(){this.getLastOper(Number(this.activeName))},formatStatus:function(t){var e=this.statusList.find((function(e){return e.code===t}));return e||(e={code:1,name:"Fetching",color:"info"}),e},dateFormat:function(t){return Object(i["a"])(t,"yyyy-MM-dd hh:mm:ss")},formatType:function(t){return this.typeList.find((function(e){return e.code===t})).name}}},b=f,p=(n("fe4c"),n("2877")),h=Object(p["a"])(b,a,r,!1,null,"9197edf4",null);e["default"]=h.exports},fe4c:function(t,e,n){"use strict";n("6b11")}}]);