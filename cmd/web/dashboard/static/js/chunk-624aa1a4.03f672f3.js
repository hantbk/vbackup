(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-624aa1a4"],{2e3:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-terminal"},[t.showHeader?n("div",{staticClass:"terminal-header"},[n("h4",[t._v(t._s(t.title))]),t._m(0),n("div",{staticClass:"terminal-header-right"},[0!==t.status?n("span",{class:t.formatStatus(t.status).color},[t._v(t._s(t.formatStatus(t.status).name))]):t._e(),n("span",{staticStyle:{"margin-left":"10px"}},[t._v("Automatic scrolling "),n("el-switch",{model:{value:t.autoScroll,callback:function(e){t.autoScroll=e},expression:"autoScroll"}})],1)])]):t._e(),n("div",[n("div",{ref:"terminalWindow",staticClass:"terminal-window"},[t._l(t.messageList,(function(e,i){return n("p",{key:i},[e.time?n("span",[t._v(t._s(t.dateFormat(e.time)))]):t._e(),e.level?n("span",{staticClass:"level",class:t.formatLevel(e.level).color},[t._v(t._s(t.formatLevel(e.level).name))]):t._e(),n("code",[t._v(t._s(e.text))])])})),n("p",{ref:"terminalLastLine",staticClass:"terminal-last-line"})],2)])])},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"shell-dots"},[n("li",{staticClass:"shell-dots-red"}),n("li",{staticClass:"shell-dots-yellow"}),n("li",{staticClass:"shell-dots-green"})])}],o=(n("7db0"),n("fb6a"),n("a9e3"),n("d3b7"),n("159b"),n("ed08")),s=n("9cbb"),r={name:"Terminal",props:{title:{required:!1,type:String,default:"Terminal"},status:{required:!1,type:Number,default:0},showHeader:{required:!1,type:Boolean,default:!1},autoScroll:{required:!1,type:Boolean,default:!0},init:{required:!1,type:Boolean,default:!0},data:{required:!0,type:Array,default:function(){return[]}}},data:function(){return{messageList:[],levelList:s["b"],statusList:[{code:1,name:"Retrieving",color:"info"},{code:2,name:"Normal",color:"success"},{code:3,name:"Abnormal",color:"error"}]}},watch:{data:function(t){var e=this;null===t&&(t=[]);var n=[];!this.init&&t.length>this.messageList.length?n=t.slice(this.messageList.length,t.length):(this.messageList=[],n=t),n.forEach((function(t){var n=e.messageList[e.messageList.length-1];t.clear&&void 0!==n&&n.clear&&e.messageList.pop(),e.pushToList(t)}))}},methods:{dateFormat:function(t){return Object(o["a"])(t,"yyyy-MM-dd hh:mm:ss")},formatStatus:function(t){var e=this.statusList.find((function(e){return e.code===t}));return e||(e={code:1,name:"Info",color:"info"}),e},formatLevel:function(t){var e=this.levelList.find((function(e){return e.code===t}));return e||(e={code:1,name:"Info",color:"info"}),e},pushToList:function(t){this.messageList.push(t),this.autoScroll&&this.autoScrollHandler()},autoScrollHandler:function(){var t=this;this.$nextTick((function(){t.$refs.terminalWindow.scrollTop=t.$refs.terminalLastLine.offsetTop}))}}},c=r,l=(n("38f0"),n("2877")),u=Object(l["a"])(c,i,a,!1,null,"284c54bb",null);e["a"]=u.exports},2900:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return a}));var i="/api/v1/ws/task/sockjs",a="/api/v1/ws/log/sockjs"},"2c25":function(t,e,n){"use strict";n("351d")},"351d":function(t,e,n){},"38f0":function(t,e,n){"use strict";n("532c")},"3ffe":function(t,e,n){"use strict";n.d(e,"g",(function(){return a})),n.d(e,"e",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return r})),n.d(e,"q",(function(){return c})),n.d(e,"o",(function(){return l})),n.d(e,"h",(function(){return u})),n.d(e,"n",(function(){return d})),n.d(e,"j",(function(){return p})),n.d(e,"k",(function(){return f})),n.d(e,"a",(function(){return m})),n.d(e,"m",(function(){return h})),n.d(e,"l",(function(){return y})),n.d(e,"i",(function(){return g})),n.d(e,"d",(function(){return b})),n.d(e,"p",(function(){return v})),n.d(e,"f",(function(){return _}));n("99af");var i=n("b775");function a(t){return Object(i["a"])({url:"/repository",method:"get",params:t})}function o(t){return Object(i["a"])({url:"/repository/".concat(t),method:"get"})}function s(t){return Object(i["a"])({url:"/repository/".concat(t),method:"delete"})}function r(t){return Object(i["a"])({url:"/repository",method:"post",data:t})}function c(t){return Object(i["a"])({url:"/repository/".concat(t.id),method:"put",data:t})}function l(t){return Object(i["a"])({url:"/restic/".concat(t.id,"/snapshots"),method:"get",params:t})}function u(t,e,n){return Object(i["a"])({url:"/restic/".concat(t,"/ls/").concat(e),method:"get",params:n})}function d(t,e,n){return Object(i["a"])({url:"/restic/".concat(t,"/search/").concat(e),method:"get",params:n})}function p(t){return Object(i["a"])({url:"/restic/".concat(t,"/parms"),method:"get"})}function f(t){return Object(i["a"])({url:"/restic/".concat(t,"/parmsForMy"),method:"get"})}function m(t){return Object(i["a"])({url:"/restic/".concat(t,"/check"),method:"post"})}function h(t){return Object(i["a"])({url:"/restic/".concat(t,"/rebuild-index"),method:"post"})}function y(t){return Object(i["a"])({url:"/restic/".concat(t,"/prune"),method:"post"})}function g(t){return Object(i["a"])({url:"/restic/".concat(t,"/migrate"),method:"post"})}function b(t,e){return Object(i["a"])({url:"/restic/".concat(t,"/forget"),method:"post",params:{snapshotid:e}})}function v(t,e){return Object(i["a"])({url:"/restic/".concat(t,"/unlock"),method:"post",params:{all:e}})}function _(t,e){return Object(i["a"])({url:"/operation/last/".concat(e,"/").concat(t),method:"get"})}},"532c":function(t,e,n){},"9cbb":function(t,e,n){"use strict";n.d(e,"e",(function(){return i})),n.d(e,"a",(function(){return a})),n.d(e,"d",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return r}));var i=[{code:1,name:"S3",tips:"Minio"},{code:3,name:"Sftp",tips:"Not recommended"},{code:4,name:"Local",tips:"Recommended for testing"},{code:5,name:"Rest",tips:"Recommended"}],a=[{code:"last",name:"Count",tips:"Count"},{code:"hourly",name:"Hourly",tips:"Hourly"},{code:"daily",name:"Daily",tips:"Daily"},{code:"weekly",name:"Weekly",tips:"Weekly"},{code:"monthly",name:"Monthly",tips:"Monthly"},{code:"yearly",name:"Yearly",tips:"Yearly"}],o=[{code:1,name:"Fetching",color:"info"},{code:2,name:"Normal",color:"success"},{code:3,name:"Error",color:"danger"}],s=[{code:1,name:"Info",color:"info"},{code:2,name:"Warning",color:"warning"},{code:3,name:"Success",color:"success"},{code:4,name:"Error",color:"error"}],r=[{code:0,name:"Auto",color:"success"},{code:1,name:"Off",color:"info"},{code:2,name:"Maximum",color:"warning"}]},ece7:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"handle-search"},[n("el-form",{attrs:{model:t.listQuery,inline:""},nativeOn:{submit:function(t){t.preventDefault()}}},[n("el-form-item",{attrs:{label:"Filter"}},[n("el-select",{attrs:{clearable:"",placeholder:"Select Path"},on:{change:t.handleSearch},model:{value:t.listQuery.path,callback:function(e){t.$set(t.listQuery,"path",e)},expression:"listQuery.path"}},t._l(t.pathList,(function(t,e){return n("el-option",{key:e,staticStyle:{width:"500px"},attrs:{label:t,value:t}})})),1)],1),n("el-form-item",[n("el-date-picker",{attrs:{type:"date",placeholder:"Select Date"},on:{change:t.handleSearch},model:{value:t.listQuery.date,callback:function(e){t.$set(t.listQuery,"date",e)},expression:"listQuery.date"}})],1)],1)],1),n("div",[n("el-row",{staticClass:"panel-group",attrs:{gutter:40}},[n("el-col",{staticClass:"card-panel-col",attrs:{xs:8,sm:8,lg:8}},[n("el-card",{staticClass:"box-card"},[n("div",{attrs:{slot:"header"},slot:"header"},[n("p",[t._v("Host: "+t._s(t.hostname))]),n("p",[t._v("Path: "+t._s(t.listQuery.path))]),n("p",[t._v("Total: "+t._s(t.total))]),n("div",[n("p",[t._v("Cleanup Policy:")]),t.policy.n>0?n("div",[n("p",[t._v("Retain latest "),n("i",{staticClass:"blue"},[t._v(t._s(t.policy.n+t.formatType(t.policy.type).name)+" ")]),t._v(" snapshots")]),n("el-button",{staticClass:"forget-create",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleUpdate()}}},[t._v(" Update ")]),n("el-button",{staticClass:"forget-create",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleDel()}}},[t._v(" Delete ")]),n("el-button",{staticClass:"forget-create",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.doPolicy()}}},[t._v(" Execute Now ")])],1):0===t.policy.n&&""!==t.listQuery.path?n("div",[n("el-button",{staticClass:"forget-create",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleAdd()}}},[t._v(" Set ")])],1):t._e()])]),n("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.snapList,(function(e,i){return n("el-collapse-item",{key:i,attrs:{title:e.name,name:e.name}},[n("el-timeline",t._l(e.list,(function(e,i){return n("el-timeline-item",{key:i,attrs:{timestamp:t._f("goDatToDateString")(e.time),type:"primary",icon:"el-icon-success",size:"large",placement:"top"}},[n("div",{staticClass:"timeline"},[n("span",{staticClass:"snap"},[t._v(t._s(e.short_id))]),n("el-button",{staticClass:"restore_btn",attrs:{type:"text",size:"mini"},on:{click:function(n){return t.deleteSnap(e.short_id)}}},[t._v(" Delete ")])],1)])})),1)],1)})),1),t.noMore?n("p",{staticStyle:{"font-size":"20px","text-align":"center",color:"#bbbbbb"}},[t._v("No more items")]):n("div",{staticStyle:{"text-align":"center"}},[n("el-button",{attrs:{loading:t.listLoading,type:"info",plain:""},on:{click:t.getMoreList}},[t._v("Load More")])],1)],1)],1),n("el-col",{staticClass:"card-panel-col",attrs:{xs:16,sm:16,lg:16}},[n("el-card",{staticClass:"box-card"},[n("Terminal",{attrs:{title:"Logs",showHeader:"",init:t.forgetObj.init,data:t.forgetObj.logs}})],1)],1)],1)],1),n("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,top:"5vh",width:"500px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("div",[n("el-input",{staticClass:"input-with-select",attrs:{placeholder:"Enter value",type:"Number",maxlength:"2"},model:{value:t.temp.n,callback:function(e){t.$set(t.temp,"n",e)},expression:"temp.n"}},[n("template",{slot:"prepend"},[t._v("Retain latest:")]),n("template",{slot:"append"},[n("el-select",{attrs:{placeholder:"Select",disabled:""},model:{value:t.temp.type,callback:function(e){t.$set(t.temp,"type",e)},expression:"temp.type"}},t._l(t.typeList,(function(t){return n("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})})),1)],1)],2),n("p",{staticClass:"red"},[t._v("The system will retain the latest "+t._s(t.temp.n+t.formatType(t.temp.type).name)+" snapshots, and any excess will be deleted to free up disk space.")])],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v(" Cancel ")]),n("el-button",{attrs:{type:"primary",loading:t.buttonLoading},on:{click:function(e){"create"===t.dialogStatus?t.createPolicyData():t.updatePolicyData()}}},[t._v(" Confirm ")])],1)])],1)},a=[],o=(n("99af"),n("7db0"),n("fb6a"),n("b0c0"),n("e9c4"),n("a9e3"),n("b64b"),n("d3b7"),n("159b"),n("3ffe")),s=n("ed08"),r=n("5f87"),c=n("2000"),l=n("cc7d"),u=n.n(l),d=n("2900"),p=n("9cbb"),f=n("b775");function m(t){return Object(f["a"])({url:"/policy",method:"get",params:t})}function h(t){return Object(f["a"])({url:"/policy",method:"post",data:t})}function y(t){return Object(f["a"])({url:"/policy/".concat(t.id),method:"put",data:t})}function g(t){return Object(f["a"])({url:"/policy/".concat(t),method:"delete"})}function b(t){return Object(f["a"])({url:"/policy/do/".concat(t),method:"post"})}var v={name:"Snapshot",components:{Terminal:c["a"]},data:function(){return{typeList:p["a"],list:[],total:0,snapList:[],hostname:"",pathList:[],forgetObj:{status:1,init:!0,logs:[]},textMap:{update:"Modify cleanup policy",create:"Create cleanup policy"},dialogStatus:"",dialogFormVisible:!1,buttonLoading:!1,temp:{n:90,type:"last"},policy:{n:0,type:""},forget_type:[],sock:null,sockjsOpen:!1,listLoading:!1,noMore:!0,activeName:"0",listQuery:{id:0,path:"",date:"",host:"",pageNum:1,pageSize:100}}},created:function(){this.listQuery.id=this.$route.params&&this.$route.params.id,this.getParmList(),this.getLastOper()},activated:function(){this.getParmList(),this.getLastOper()},methods:{getMoreList:function(){this.listQuery.pageNum++,this.getList()},handleSearch:function(){this.listQuery.host=this.hostname,this.listQuery.pageNum=1,this.list=[],this.snapList=[],this.policy={n:0,type:""},this.getList()},getParmList:function(){var t=this;Object(o["k"])(this.listQuery.id).then((function(e){t.pathList=e.data.paths,t.hostname=e.data.hostname}))},formatType:function(t){return this.typeList.find((function(e){return e.code===t}))},deleteSnap:function(t){var e=this;this.$confirm('Confirm "'+t+'"to be delete ?',"Delete snapshot",{type:"warning"}).then((function(){e.forgetObj.logs=[],e.forgetObj.init=!0,Object(o["d"])(e.listQuery.id,t).then((function(t){e.openSockjs(t.data)}))})).catch((function(){}))},doPolicy:function(){var t=this;this.$confirm("Are you sure you want to execute the cleanup policy? ","Execute cleanup policy",{type:"warning"}).then((function(){t.forgetObj.logs=[],t.forgetObj.init=!0,b(t.policy.id).then((function(e){t.openSockjs(e.data)}))})).catch((function(){}))},getLastOper:function(){var t=this;Object(o["f"])(this.listQuery.id,4).then((function(e){var n=e.data;n.logs||(n.logs=[]),1!==n.status?(n.logs.length>100&&(n.logs=n.logs.slice(n.logs.length-100)),t.updateLog(n,!1)):t.openSockjs(n.id)}))},getList:function(){var t=this;""!==this.listQuery.path&&(this.listLoading=!0,Object(o["o"])(this.listQuery).then((function(e){t.list=t.list.concat(e.data.items),t.snapList=t.accordionList(t.list),t.noMore=Number(e.data.pageNum)*Number(e.data.pageSize)>=e.data.total,t.total=e.data.total,t.getPolicy()})).finally((function(){t.listLoading=!1})))},accordionList:function(t){var e=this,n=[];return t.forEach((function(t){var i=Object(s["a"])(t.time,"yyyy-MM");if(e.listQuery.date){var a=Object(s["a"])(t.time,"yyyy-MM-dd"),o=Object(s["a"])(e.listQuery.date,"yyyy-MM-dd");if(a!==o)return;e.activeName=i}var r=!1;n.forEach((function(e){e.name===i&&(e.list.push(t),r=!0)})),r||n.push({name:i,list:[t]})})),n},handleAdd:function(){this.dialogStatus="create",this.dialogFormVisible=!0},handleUpdate:function(){this.dialogStatus="update",this.dialogFormVisible=!0,this.temp=this.policy},handleDel:function(){var t=this;g(this.policy.id).then((function(){t.getPolicy()}))},updateLog:function(t,e){e?this.forgetObj.logs.push(t):this.forgetObj=t,this.forgetObj.init=!e},openSockjs:function(t){var e=Object(r["a"])().token,n=this;this.sock=new u.a(d["a"]+"?token="+e),this.sock.onopen=function(){n.sockjsOpen=!0,n.sock.send(JSON.stringify({Id:t})),n.sock.onmessage=function(t){var e=JSON.parse(t.data);e.message?(n.sockjsOpen=!1,n.$notify({type:"error",title:"Error",message:e.message})):n.updateLog(e,!0)}},this.sock.onclose=function(){n.sockjsOpen=!1,n.handleSearch()}},getPolicy:function(){var t=this;this.policy={n:0,type:""},m(this.listQuery).then((function(e){var n=e.data;n.length>0?(t.policy.n=n[0].value,t.policy.type=n[0].type,t.policy.id=n[0].id):(t.policy.n=0,t.policy.type="",t.policy.id=0)}))},createPolicyData:function(){var t=this,e={repositoryId:Number(this.listQuery.id),path:this.listQuery.path,value:Number(this.temp.n),type:this.temp.type};h(e).then((function(){t.dialogFormVisible=!1,t.getPolicy()}))},updatePolicyData:function(){var t=this,e={id:this.policy.id,repositoryId:Number(this.listQuery.id),path:this.listQuery.path,value:Number(this.temp.n),type:this.temp.type};y(e).then((function(){t.dialogFormVisible=!1,t.getPolicy()}))}}},_=v,L=(n("2c25"),n("2877")),j=Object(L["a"])(_,i,a,!1,null,"137b5ab6",null);e["default"]=j.exports}}]);